
<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">
<link rel="import" href="../components/x-websocket/dist/x-websocket.html">

<polymer-element name="nn-annotable" attributes="nid">
  <template>

    <core-ajax
      id="get_comments"
      url="/{{domain}}/{{nid}}/comments"
      handleAs="json"
      on-core-response="{{populateComments}}"
      >
    </core-ajax>
    <core-ajax
      id="new_comment"
      url="/{{domain}}/{{nid}}/comments"
      handleAs="json"
      method="post"
      params='{"author":"{{author}}","text":"{{text}}"}'
      on-core-response="{{resetForm}}"
      >
    </core-ajax>
    <x-websocket
      id="websocket"
      json="true"
      url="ws://localhost:3000/primus">
    </x-websocket>

    <content></content>

    <section>
      <h2>New Annotation</h2>
      <form id="new_comment_form" on-submit="{{newComment}}">
        <p>{{message}}</p>
        <input type="email" value="{{author}}" placeholder="your email"><br/>
        <textarea value="{{text}}" placeholder="your annotation"></textarea><br/>
        <input type="submit" value="invia">
      </form>
      <h2>Annotations</h2>
      <template repeat="{{comment, i in comments}}">
        <article>
          <h3>{{comment.author}}</h3>
          <div>{{comment.text}}</div>
        </article>
      </template>
    </section>

  </template>
  <script src="nn-annotable.js"></script>
</polymer-element>
